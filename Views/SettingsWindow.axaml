<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:CryptoWidget.ViewModels"
        xmlns:svc="clr-namespace:CryptoWidget.Services;assembly=CryptoWidget"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d" d:DesignWidth="300" d:DesignHeight="400"
        x:Class="CryptoWidget.SettingsWindow"
        x:DataType="svc:SettingsService"
        Width="300" Height="400"
        MinWidth="300" MaxWidth="300"
        MinHeight="400"
        Title="設定"
        Topmost="True"
        CanResize="True"
        ExtendClientAreaToDecorationsHint="True"
        ExtendClientAreaChromeHints="NoChrome"
        ShowInTaskbar="False"
        Opacity="{Binding OpacityLevel}">

  <Border CornerRadius="10"
          Margin="10" Padding="10">

    <Grid>
      <Grid.RowDefinitions>
        <RowDefinition Height="Auto"/>
        <RowDefinition Height="*"/>
        <RowDefinition Height="Auto"/>
      </Grid.RowDefinitions>

      <!-- 標題 -->
      <TextBlock Grid.Row="0"
                 VerticalAlignment="Center"
                 Text="設定" Foreground="White" FontSize="18" FontWeight="Bold"/>

      <!-- 右上角關閉按鈕 -->
      <Button Grid.Row="0"
              VerticalAlignment="Center"
              HorizontalAlignment="Right"
              Width="24" Height="24"
              Padding="4"
              Background="Transparent" BorderThickness="0"
              FontFamily="Segoe MDL2 Assets"
              FontSize="16"
              Content="&#xE10A;"
              Click="CloseButton_Click"/>

      <!-- 中間內容區域（可滾動） -->
      <ScrollViewer Grid.Row="1" 
                    VerticalScrollBarVisibility="Auto"
                    HorizontalScrollBarVisibility="Disabled"
                    Margin="0,0,10,0">
                <StackPanel Spacing="10" Margin="0,0,20,0" VerticalAlignment="Center">
          <!-- 透明度 -->
          <Grid>
            <Grid.ColumnDefinitions>
              <ColumnDefinition Width="*"/>
              <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            <TextBlock Grid.Column="0" Text="視窗透明度" Foreground="White" FontSize="14" FontWeight="Bold" VerticalAlignment="Center"/>
            <TextBlock Grid.Column="1" Foreground="White" VerticalAlignment="Center"
                     Text="{Binding OpacityLevel, StringFormat='{}{0:P0}'}"/>
          </Grid>
          <Slider Minimum="0.1" Maximum="1.0"
            Value="{Binding OpacityLevel}"
            TickFrequency="0.1"/>

          <!-- 保持最上層 -->
          <Grid>
            <Grid.ColumnDefinitions>
              <ColumnDefinition Width="*"/>
              <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            <TextBlock Grid.Column="0" Text="保持最上層" Foreground="White" FontSize="14" FontWeight="Bold" VerticalAlignment="Center"/>
            <CheckBox Grid.Column="1" IsChecked="{Binding KeepOnTop}" VerticalAlignment="Center" />
          </Grid>

          <!-- 幣種輸入＋新增 -->
          <Grid>
            <Grid.RowDefinitions>
              <RowDefinition Height="Auto"/>
              <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
              <ColumnDefinition Width="*"/>
              <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            <TextBlock Grid.Column="0" Grid.Row="0"
                       Text="新增幣種" Foreground="White" FontSize="14" FontWeight="Bold" VerticalAlignment="Center"/>
            <TextBox Grid.Column="0" Grid.Row="1"
                     VerticalAlignment="Center"
                     Watermark="e.g. BTC 或 BTC/USDT"
                     Text="{Binding NewCryptoSymbol, UpdateSourceTrigger=PropertyChanged}" />
            <Button Grid.Column="1" Grid.Row="1"
                    Content="➕" Margin="5,0,0,0"
                    VerticalAlignment="Center"
                    Command="{Binding AddCryptoCommand}" />
          </Grid>

          <!-- 清單 -->
          <ItemsControl ItemsSource="{Binding CryptoList}">
            <ItemsControl.ItemTemplate>
              <DataTemplate>
                <StackPanel Orientation="Horizontal" Spacing="4" Margin="0,2">
                  <TextBlock Text="{Binding .}" Foreground="White" VerticalAlignment="Center"/>
                  <Button Content="✖"
                          Padding="0"
                          VerticalAlignment="Center"
                          Click="RemoveCrypto_Click"
                          Tag="{Binding .}" />
                </StackPanel>
              </DataTemplate>
            </ItemsControl.ItemTemplate>
          </ItemsControl>
        </StackPanel>
      </ScrollViewer>

      <!-- 底部按鈕區域 -->
      <StackPanel Grid.Row="2" 
                  Orientation="Horizontal" 
                  HorizontalAlignment="Right" 
                  Spacing="10"
                  Margin="0,10,0,0">
        <Button Content="取消" 
                Width="60" Height="30"
                HorizontalContentAlignment="Center" 
                VerticalContentAlignment="Center"
                Click="CancelButton_Click"/>
        <Button Content="保存" 
                Width="60" Height="30"
                HorizontalContentAlignment="Center" 
                VerticalContentAlignment="Center"
                Click="SaveButton_Click"/>
      </StackPanel>
    </Grid>
  </Border>
</Window>
