<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:CryptoWidget.ViewModels"
        xmlns:svc="using:CryptoWidget.ViewModels"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:c="https://codewf.com"
        xmlns:converters="using:Avalonia.Data.Converters"
        mc:Ignorable="d" d:DesignWidth="400" d:DesignHeight="400"
        x:Class="CryptoWidget.SettingsWindow"
        x:DataType="svc:SettingViewModel"
        Width="400" Height="450"
        MinWidth="400" MaxWidth="400"
        MinHeight="450"
        Title="{c:I18n 'SettingsWindowTitle'}"
        Topmost="{Binding KeepOnTop}"
        CanResize="True"
        ShowInTaskbar="False"
        Opacity="{Binding OpacityLevel}"
        ExtendClientAreaChromeHints="NoChrome"
        ExtendClientAreaTitleBarHeightHint="-1"
        ExtendClientAreaToDecorationsHint="False"
        SystemDecorations="None"
        >

  <Border CornerRadius="10"
          Margin="10" Padding="10"
          >

    <Grid>
      <Grid.RowDefinitions>
        <RowDefinition Height="Auto"/>
        <RowDefinition Height="*"/>
        <RowDefinition Height="Auto"/>
      </Grid.RowDefinitions>

      <!-- 標題 -->
      <TextBlock Grid.Row="0"
                 VerticalAlignment="Center"
                 Text="{c:I18n 'SettingsTitle'}" Foreground="White" FontSize="18" FontWeight="Bold"/>

      <!-- 右上角關閉按鈕 -->
      <Button Grid.Row="0"
              VerticalAlignment="Center"
              HorizontalAlignment="Right"
              Width="24" Height="24"
              Padding="0"
              Background="Transparent" BorderThickness="0"
              FontFamily="Segoe MDL2 Assets"
              FontSize="16"
              HorizontalContentAlignment="Center"
              VerticalContentAlignment="Center"
              Content="&#xE10A;"
              Click="CancelButton_Click"/>

      <!-- 中間內容區域（可滾動） -->
      <ScrollViewer Grid.Row="1" 
                    VerticalScrollBarVisibility="Auto"
                    HorizontalScrollBarVisibility="Disabled"
                    Margin="0,0,10,0">
                <StackPanel Spacing="10" Margin="0,0,20,0">

          <!-- 語系選擇 -->
          <Grid>
            <Grid.ColumnDefinitions>
              <ColumnDefinition Width="*"/>
              <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            <TextBlock Grid.Column="0" Text="{c:I18n 'Settings_LanguageLabel'}" Foreground="White" FontSize="14" FontWeight="Bold" VerticalAlignment="Center"/>
            <ComboBox Grid.Column="1" 
                      ItemsSource="{Binding Source={x:Static svc:SettingViewModel.SupportedLanguages}}"
                      SelectedItem="{Binding SelectedLanguageItem}"
                      SelectionChanged="OnSelectedLanguageChanged"
                      Width="160"
                      VerticalAlignment="Center">
              <ComboBox.ItemTemplate>
                <DataTemplate>
                  <TextBlock Text="{Binding .}" Foreground="White"/>
                </DataTemplate>
              </ComboBox.ItemTemplate>
            </ComboBox>
          </Grid>

          <!-- 透明度 -->
          <Grid>
            <Grid.ColumnDefinitions>
              <ColumnDefinition Width="*"/>
              <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            <TextBlock Grid.Column="0" Text="{c:I18n 'Settings_OpacityLabel'}" Foreground="White" FontSize="14" FontWeight="Bold" VerticalAlignment="Center"/>
            <TextBlock Grid.Column="1" Foreground="White" VerticalAlignment="Center"
                     Text="{Binding OpacityLevel, StringFormat='{}{0:P0}'}"/>
          </Grid>
          <Slider Minimum="0.1" Maximum="1.0"
            Value="{Binding OpacityLevel}"
            TickFrequency="0.1"/>

          <!-- 保持最上層 -->
          <Grid>
            <Grid.ColumnDefinitions>
              <ColumnDefinition Width="*"/>
              <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            <TextBlock Grid.Column="0" Text="{c:I18n 'Settings_KeepOnTopLabel'}" Foreground="White" FontSize="14" FontWeight="Bold" VerticalAlignment="Center"/>
            <CheckBox Grid.Column="1" IsChecked="{Binding KeepOnTop}" VerticalAlignment="Center" />
          </Grid>

          <!-- 關閉行為 -->
          <Grid>
            <Grid.ColumnDefinitions>
              <ColumnDefinition Width="*"/>
              <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            <TextBlock Grid.Column="0" Text="{c:I18n 'Settings_CloseBehaviorLabel'}" Foreground="White" FontSize="14" FontWeight="Bold" VerticalAlignment="Center"/>
            <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
              <RadioButton Content="{c:I18n 'Settings_HideOption'}" IsChecked="{Binding CloseOnExit, Converter={x:Static converters:BoolConverters.Not}}" 
                           Foreground="White" Margin="0,0,10,0"/>
              <RadioButton Content="{c:I18n 'Settings_CloseOption'}" IsChecked="{Binding CloseOnExit}" 
                           Foreground="White"/>
            </StackPanel>
          </Grid>

          <!-- 交易所選擇 -->
          <Grid>
            <Grid.ColumnDefinitions>
              <ColumnDefinition Width="*"/>
              <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            <TextBlock Grid.Column="0" Text="{c:I18n 'Settings_ExchangeLabel'}" Foreground="White" FontSize="14" FontWeight="Bold" VerticalAlignment="Center"/>
            <ComboBox Grid.Column="1" 
                      ItemsSource="{Binding Source={x:Static svc:SettingViewModel.SupportedExchanges}}"
                      SelectedItem="{Binding SelectedExchange}"
                      Width="160"
                      VerticalAlignment="Center"/>
          </Grid>

          <!-- 幣種輸入＋新增 -->
          <Grid>
            <Grid.RowDefinitions>
              <RowDefinition Height="Auto"/>
              <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
              <ColumnDefinition Width="*"/>
              <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            <TextBlock Grid.Column="0" Grid.Row="0"
                       Text="{c:I18n 'Settings_AddCryptoLabel'}" Foreground="White" FontSize="14" FontWeight="Bold" VerticalAlignment="Center"/>
            <TextBox Grid.Column="0" Grid.Row="1"
                     VerticalAlignment="Center"
                     Watermark="{c:I18n 'Settings_AddCryptoWatermark'}"
                     Text="{Binding NewCryptoSymbol, UpdateSourceTrigger=PropertyChanged}" />
            <Button Grid.Column="1" Grid.Row="1"
                    Content="➕" Margin="5,0,0,0"
                    VerticalAlignment="Center"
                    Command="{Binding AddCryptoCommand}" />
          </Grid>

          <!-- 清單 -->
          <ItemsControl ItemsSource="{Binding CryptoList}">
            <ItemsControl.ItemTemplate>
              <DataTemplate>
                <StackPanel Orientation="Horizontal" Spacing="4" Margin="0,2">
                  <TextBlock Text="{Binding .}" Foreground="White" VerticalAlignment="Center"/>
                  <Button Content="✖"
                          Padding="0"
                          VerticalAlignment="Center"
                          Click="RemoveCrypto_Click"
                          Tag="{Binding .}" />
                </StackPanel>
              </DataTemplate>
            </ItemsControl.ItemTemplate>
          </ItemsControl>
        </StackPanel>
      </ScrollViewer>

      <!-- 底部按鈕區域 -->
      <StackPanel Grid.Row="2" 
                  Orientation="Horizontal" 
                  HorizontalAlignment="Right" 
                  Spacing="10"
                  Margin="0,10,0,0">
        <Button Content="{c:I18n 'Btn_Cancel'}" 
                Width="60" Height="30"
                FontSize="12"
                HorizontalContentAlignment="Center" 
                VerticalContentAlignment="Center"
                Click="CancelButton_Click"/>
        <Button Content="{c:I18n 'Btn_Save'}" 
                Width="60" Height="30"
                FontSize="12"
                HorizontalContentAlignment="Center" 
                VerticalContentAlignment="Center"
                Click="SaveButton_Click"/>
      </StackPanel>
    </Grid>
  </Border>
</Window>
